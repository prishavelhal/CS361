<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav-links {
            display: flex;
            gap: 8px;
            list-style: none;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: #4a5568;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .nav-links a.active {
            background: #667eea;
            color: white;
        }

        /* Dashboard Header */
        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dashboard-header h2 {
            font-size: 32px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .dashboard-header h4 {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .dashboard-header p {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        /* Reminder Section */
        .reminder-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #f59e0b;
        }

        .reminder-section h3 {
            color: #92400e;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .reminder-section p {
            color: #78350f;
            font-size: 14px;
        }

        /* Cards Grid */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #718096;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .card p {
            font-size: 32px;
            font-weight: 700;
            color: #2d3748;
        }

        .card p.positive {
            color: rgb(63, 165, 63);
        }

        .card p.negative {
            color: #ef4444;
        }

        /* Savings Progress */
        #savings-progress {
            background: #e2e8f0;
            border-radius: 12px;
            height: 24px;
            overflow: hidden;
            margin: 16px 0;
            position: relative;
        }

        #savings-progress-fill {
            background: #667eea;
            height: 100%;
            border-radius: 12px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        #savings-text {
            font-size: 14px !important;
            font-weight: 500 !important;
            color: #4a5568 !important;
            margin-top: 8px;
        }

        /* Logout Section */
        .logout-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logout-section button {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 12px 32px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-section button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-header h2 { font-size: 24px; }
            .cards { grid-template-columns: 1fr; }
            nav { padding: 12px 16px; }
            .nav-links a { padding: 10px 16px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <ul class="nav-links">
                <li><a href="index.html" class="active">Dashboard</a></li>
                <li><a href="expenses.html">Expenses</a></li>
                <li><a href="income.html">Income</a></li>
            </ul>
        </nav>

        <main>
            <div class="dashboard-header">
                <h2>Finance Dashboard</h2>
                <h4>Welcome back! Here's your financial overview</h4>
                <p>Track your income, expenses, and savings all in one place. Your financial data is private and stored locally on your device.</p>
            </div>

            <div class="reminder-section">
                <h3>ðŸ’¡ Financial Reminder</h3>
                <p id="reminder">Review your monthly budget and set savings goals!</p>
            </div>
            
            <div class="cards">
                <div class="card">
                    <h3>Total Income</h3>
                    <p id="dashboard-income">$0.00</p>
                </div>
                <div class="card">
                    <h3>Total Expenses</h3>
                    <p id="dashboard-expense">$0.00</p>
                </div>
                <div class="card">
                    <h3>Net Balance</h3>
                    <p id="net-balance-value">$0.00</p>
                </div>
                <div class="card">
                    <h3>Savings Progress</h3>
                    <div id="savings-progress">
                        <div id="savings-progress-fill">0%</div>
                    </div>
                    <p id="savings-text">No savings goal set</p>
                </div>
            </div>
            
            <div class="logout-section">
                <button onclick="logout()">Logout</button>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Load income from localStorage
            const income = parseFloat(localStorage.getItem("totalIncome")) || 0;
            document.getElementById("dashboard-income").textContent = `${income.toFixed(2)}`;
            
            // Load expenses from localStorage
            const expense = parseFloat(localStorage.getItem("totalExpense")) || 0;
            document.getElementById("dashboard-expense").textContent = `${expense.toFixed(2)}`;
            
            // Calculate net balance
            const netBalance = income - expense;
            const netElement = document.getElementById("net-balance-value");
            netElement.textContent = `${netBalance.toFixed(2)}`;
            netElement.className = netBalance >= 0 ? 'positive' : 'negative';
            
            // Fetch net balance from microservice (optional - if service is running)
            fetch("http://localhost:5004/net", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ income, expenses: expense })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("net-balance-value").textContent = `${data.net.toFixed(2)}`;
                const netVal = data.net;
                netElement.className = netVal >= 0 ? 'positive' : 'negative';
            })
            .catch(error => {
                console.log("Net balance microservice unavailable, using calculated value");
            });
            
            // Fetch savings progress from microservice
            fetch('http://localhost:5005/progress')
            .then(response => response.json())
            .then(data => {
                const progress = data.progress;
                document.getElementById("savings-progress-fill").style.width = `${progress}%`;
                document.getElementById("savings-progress-fill").textContent = `${progress}%`;
                document.getElementById("savings-text").textContent = 
                    `${data.goal_name}: ${data.current_amount} of ${data.goal_amount} (${progress}%)`;
            })
            .catch(error => {
                document.getElementById("savings-text").textContent = "Savings tracking unavailable";
                console.log("Savings microservice unavailable");
            });
            
            // Fetch reminder from microservice
            fetch("https://notifications-y13l.onrender.com/notifications")
            .then(response => response.json())
            .then(data => {
                document.getElementById("reminder").textContent = data.notification;
            })
            .catch(error => {
                // Fallback reminders if microservice is unavailable
                const reminders = [
                    "Review your monthly budget and set savings goals!",
                    "Consider setting up automatic savings transfers",
                    "Check for subscription services you no longer use",
                    "Track your spending categories this month",
                    "Plan your financial goals for next quarter"
                ];
                document.getElementById("reminder").textContent = 
                    reminders[Math.floor(Math.random() * reminders.length)];
                console.log("Notifications microservice unavailable, using fallback");
            });
        });

        // Check if user is logged in
        document.addEventListener("DOMContentLoaded", function() {
            const user = localStorage.getItem("userId");
            if(!user){
                window.location.href = "login.html";
            }
        });

        function logout() {
            if (confirm("Are you sure you want to logout?")) {
                localStorage.removeItem("userId");
                window.location.href = "login.html";
            }
        }
    </script>
</body>
</html>